/*
  filename: integralui.treeview.js
  version : 0.9.012 BETA
  Copyright Â© 2016-2017 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/iui-web-license-agreement.pdf.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(f,b){function a(){this.constructor=f}for(var c in b)b.hasOwnProperty(c)&&(f[c]=b[c]);f.prototype=null===b?Object.create(b):(a.prototype=b.prototype,new a)},__decorate=this&&this.__decorate||function(f,b,a,c){var d=arguments.length,e=3>d?b:null===c?c=Object.getOwnPropertyDescriptor(b,a):c,g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)e=Reflect.decorate(f,b,a,c);else for(var h=f.length-1;0<=h;h--)if(g=f[h])e=(3>d?g(e):3<d?g(b,a,e):
g(b,a))||e;return 3<d&&e&&Object.defineProperty(b,a,e),e},__metadata=this&&this.__metadata||function(f,b){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(f,b)},core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_dragdrop_service_1=require("../services/integralui.dragdrop.service"),
integralui_base_list_1=require("./integralui.base.list"),integralui_treeitem_1=require("./integralui.treeitem"),IntegralUITreeView=function(f){function b(a,c,b,e,g,h,k){f.call(this,a,c,b,e,g);this.dataService=a;this.dragDropService=c;this.elemRef=b;this.elemRenderer=e;this.commonService=g;this.cmpResolver=h;this.baseService=k;this.isThereChildItems=!1;this.blockSize={width:0,height:0};this.trialRef=null;this.afterCollapse=new core_1.EventEmitter;this.afterExpand=new core_1.EventEmitter;this.beforeCollapse=
new core_1.EventEmitter;this.beforeExpand=new core_1.EventEmitter;this.currentScrollPos={x:0,y:0};this.maxScrollPos={x:0,y:0};this.itemList=[]}__extends(b,f);b.prototype.ngOnInit=function(){this.baseService.setComponent(this);this.dataService.init([{data:this.items}]);this.updateCurrentList();this.generalClassName="iui-treeview";this.initStyle()};b.prototype.ngAfterViewInit=function(){var a=this,c=setTimeout(function(){var b=a.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUITComponent);
b&&a.contentRef&&(a.trialRef=a.contentRef.createComponent(b));clearTimeout(c)},100)};b.prototype.ngAfterContentInit=function(){};b.prototype.ngOnDestroy=function(){this.trialRef&&this.trialRef.destroy()};b.prototype.ngAfterContentChecked=function(){};b.prototype.updateOptions=function(a){a?this.options={allowDrag:this.commonService.isFieldAvailable(a.allowDrag,!1),allowDrop:this.commonService.isFieldAvailable(a.allowDrop,!0),dataFields:null,selectedItem:this.commonService.isFieldAvailable(a.selectedItem,
this.options.selectedItem?this.options.selectedItem:null)}:(this.options={allowDrag:!0,allowDrop:!0,dataFields:null,selectedItem:null},this.updateDataFields())};b.prototype.updateDataFields=function(a){this.options.dataFields=a?{allowDrag:a.allowDrag?a.allowDrag:"allowDrag",allowDrop:a.allowDrop?a.allowDrop:"allowDrop",allowEdit:a.allowEdit?a.allowEdit:"allowEdit",allowFocus:a.allowFocus?a.allowFocus:"allowFocus",autoCheck:a.autoCheck?a.autoCheck:"autoCheck",checkBoxSettings:a.checkBoxSettings?a.checkBoxSettings:
"checkBoxSettings",checked:a.checked?a.checked:"checked",checkState:a.checkState?a.checkState:"checkState",content:a.content?a.content:"content",contextMenu:a.contextMenu?a.contextMenu:"contextMenu",enabled:a.enabled?a.enabled:"enabled",expanded:a.expanded?a.expanded:"expanded",hasChildren:a.hasChildren?a.hasChildren:"hasChildren",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",items:a.items?a.items:"items",pid:a.pid?a.pid:"pid",statusIcon:a.statusIcon?a.statusIcon:"statusIcon",style:a.style?a.style:
"style",templateObj:a.templateObj?a.templateObj:"templateObj",text:a.text?a.text:"text",tooltip:a.tooltip?a.tooltip:"tooltip",value:a.value?a.value:"value"}:{allowDrag:"allowDrag",allowDrop:"allowDrop",allowEdit:"allowEdit",allowFocus:"allowFocus",autoCheck:"autoCheck",checkBoxSettings:"checkBoxSettings",checked:"checked",checkState:"checkState",content:"content",contextMenu:"contextMenu",enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",items:"items",pid:"pid",statusIcon:"statusIcon",
style:"style",templateObj:"templateObj",text:"text",tooltip:"tooltip",value:"value"}};b.prototype.updateCurrentList=function(){var a=this;a.currentList.length=0;a.isThereChildItems=!1;var c=a.dataService.getList();c&&c.forEach(function(c){return a.addChildItems(c,null,!1)})};b.prototype.addChildItems=function(a,c,b,e){var d=this,f=!0;if(!a[d.options.dataFields.items])return f=d.addItemToCurrentList(a,c,b,e);if(f=d.addItemToCurrentList(a,c,b,e)){var k=0,l=!0;(b||d.isItemExpanded(a))&&(c=a[d.options.dataFields.items])&&
c.forEach(function(c){(l=d.addChildItems(c,a[d.options.dataFields.id],b,a))&&k++});b||d.isThereChildItems||!(0<k||!d.isItemExpanded(a)&&a[d.options.dataFields.items]&&0<a[d.options.dataFields.items].length&&d.isThereVisibleChildren(a))||(d.isThereChildItems=!0)}return f};b.prototype.addItemToCurrentList=function(a,c,b,e){a.type="item";a[this.options.dataFields.id]||(a[this.options.dataFields.id]=this.commonService.getUniqueId());c&&(a[this.options.dataFields.pid]=c);(c=this.isItemAllowed(a))&&this.currentList.push(a);
return c};b.prototype.collapse=function(a){this.toggle(a,!1)};b.prototype.expand=function(a){this.toggle(a,!0)};b.prototype.toggle=function(a,c){if(a){if((a[this.options.dataFields.hasChildren]||a[this.options.dataFields.items]&&0!=a[this.options.dataFields.items].length)&&!(c&&0!=a[this.options.dataFields.expanded]||!1===c&&0==a[this.options.dataFields.expanded])){var b=void 0!==c?c:!1!==a[this.options.dataFields.expanded]?!0:!1,b=void 0!=c?c:!b,e=this.getComponentFromItem(a);e&&(e.expanded=b)}}else(this.itemList=
this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(a){a.toggle(c,!0)})};b.prototype.getItemFromComponent=function(a){return a&&a.data?a.data:this.items&&(this.itemList=this.contentList.toArray(),a=this.itemList.indexOf(a),0<=a&&a<this.items.length)?this.items[a]:null};b.prototype.getItemIndex=function(a){return this.itemList&&0<this.itemList.length?this.itemList.indexOf(a):-1};b.prototype.getParent=function(a){return this.dataService.getParent(a)};b.prototype.isChildOf=
function(a,b){var c=!1;if(a&&b){var e=b[this.options.dataFields.items];if(e&&0<e.length)for(var f=0;f<e.length;f++){if(this.commonService.isEqual(a[this.options.dataFields.id],e[f][this.options.dataFields.id])){c=!0;break}else c=this.isChildOf(a,e[f]);if(c)break}}return c};b.prototype.isItemExpanded=function(a){return a?a[this.options.dataFields.expanded]||void 0===a[this.options.dataFields.expanded]?!0:!1:!0};b.prototype.isParentOf=function(a,b){var c=this.dataService.getParent(b);return a&&b&&c&&
this.commonService.isEqual(a[this.options.dataFields.id],c[this.options.dataFields.id])?!0:!1};b.prototype.isThereChildren=function(){return this.isThereChildItems};b.prototype.isThereVisibleChildren=function(a){var b=!1;if(a&&(a=a[this.options.dataFields.items]))for(var d=0;d<a.length;d++)if(this.isItemAllowed(a[d])){b=!0;break}return b};b.prototype.invokeEvent=function(a,b){var c=!0;if(b){var e={cancel:!1,item:b};switch(a){case "AFTER_COLLAPSE":this.afterCollapse.emit({item:b});break;case "AFTER_EXPAND":this.afterExpand.emit({item:b});
break;case "BEFORE_COLLAPSE":this.beforeCollapse.emit(e);c=!e.cancel;break;case "BEFORE_EXPAND":this.beforeExpand.emit(e),c=!e.cancel}}return c};b.prototype.invokeMethod=function(a,b){if(b)switch(a){case "CHANGE_EXPANDED":this.changeExpanded(b.component);break;case "SELECT_ITEM":this.processSelection(b.event,b.item);break;case "UPDATE_SELECTION":this.updateSelection(b.event,b.item)}return!0};b.prototype.changeExpanded=function(a){a&&a.data&&(a.data[this.options.dataFields.expanded]=a.expanded)};b.prototype.getContentSize=
function(){return this.contentElem?{width:this.contentElem.nativeElement.offsetWidth,height:this.contentElem.nativeElement.offsetHeight}:{width:0,height:0}};b.prototype.refresh=function(){this.clearComponentSelection();for(var a=0;a<this.currentSelectedItems.length;a++){var b=this.getComponentFromItem(this.currentSelectedItems[a]);b&&(b.state|=integralui_core_1.IntegralUIObjectState.selected)}};b.prototype.getComponentFromItem=function(a){var b=null;if((this.itemList=this.contentList.toArray())&&
0<this.itemList.length)for(var d=0;!b&&d<this.itemList.length;){b=this.itemList[d];if(this.getItemFromComponent(b)==a)break;else b=b.getComponentFromItem(a);d++}return b};b.prototype.updateLayout=function(){this.updateCurrentList()};b.prototype.scrollPos=function(a){if(a&&this.elemRef){var b=this.elemRef.nativeElement.firstElementChild.scrollWidth,d=this.elemRef.nativeElement.firstElementChild.scrollHeight;this.maxScrollPos={x:b>this.elemRef.nativeElement.firstElementChild.clientWidth?b-this.elemRef.nativeElement.firstElementChild.clientWidth:
0,y:d>this.elemRef.nativeElement.firstElementChild.clientHeight?d-this.elemRef.nativeElement.firstElementChild.clientHeight:0};this.currentScrollPos.x=Math.max(0,Math.min(a.x,this.maxScrollPos.x));this.currentScrollPos.y=Math.max(0,Math.min(a.y,this.maxScrollPos.y));this.elemRef.nativeElement.firstElementChild.scrollLeft=this.currentScrollPos.x;this.elemRef.nativeElement.firstElementChild.scrollTop=this.currentScrollPos.y}return this.currentScrollPos};b.prototype.findItemById=function(a){return this.dataService.findObjectById(a)};
b.prototype.findItemByText=function(a){return this.dataService.findObjectByText(a)};b.prototype.clearComponentSelection=function(){(this.itemList=this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(a){a.state&=~integralui_core_1.IntegralUIObjectState.selected;a.clearComponentSelection()})};__decorate([core_1.ViewChildren(integralui_treeitem_1.IntegralUITreeItem),__metadata("design:type",core_1.QueryList)],b.prototype,"contentList",void 0);__decorate([core_1.ViewChild("content",
{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],b.prototype,"contentRef",void 0);__decorate([core_1.ViewChild("content",{read:core_1.ElementRef}),__metadata("design:type",core_1.ElementRef)],b.prototype,"contentElem",void 0);__decorate([core_1.ContentChild(core_1.TemplateRef),__metadata("design:type",Object)],b.prototype,"itemTemplate",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"afterCollapse",void 0);__decorate([core_1.Output(),
__metadata("design:type",core_1.EventEmitter)],b.prototype,"afterExpand",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"beforeCollapse",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"beforeExpand",void 0);return b=__decorate([core_1.Component({selector:"iui-treeview",template:'\n\t\t<div [ngClass]="getControlClass()" (mouseenter)="onCtrlMouseEnter($event)" (mouseleave)="onCtrlMouseLeave($event)" (dragleave)="ctrlDragLeave($event)" (dragover)="ctrlDragOver($event)" (drop)="ctrlDragDrop($event)">\n\t\t\t<ul style="margin:0;padding:0;" #content>\n\t            <iui-treeitem *ngFor="let item of items" [text]="item.text" [templateRef]="itemTemplate" [data]="item" [items]="item.items">\n\t\t\t\t</iui-treeitem> \n\t\t\t</ul>\n\t\t</div>\n\t',
inputs:"appRef controlStyle data items selectedItem selectionMode state".split(" "),outputs:"afterSelect beforeSelect clear dragDrop dragOver itemAdding itemAdded itemRemoving itemRemoved selectionChanged".split(" "),providers:[integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService]}),__metadata("design:paramtypes",[integralui_data_service_1.IntegralUIDataService,integralui_dragdrop_service_1.IntegralUIDragDropService,core_1.ElementRef,core_1.Renderer,integralui_common_service_1.IntegralUICommonService,
core_1.ComponentFactoryResolver,integralui_core_1.IntegralUIBaseService])],b)}(integralui_base_list_1.IntegralUIBaseList);exports.IntegralUITreeView=IntegralUITreeView;